{% extends 'base.html' %}
{% load i18n %}

{% block content %}
  <div>
    <h2 style="color: black;">{% trans 'Welcome to the Test Dashboard' %}</h2>
    <p style="color: black;">{% trans 'Select a department from the sidebar to begin.' %}</p>

    <br><br>

    <h2 style="color: black;">{% trans 'Dashboard - Test Results' %}</h2>

    {% if results %}
      <table border="1" cellpadding="10" style="width: 100%; color: black; background-color: #f9f9f9;">
        <thead>
          <tr>
            {% if request.user.is_staff %}<th>{% trans 'User' %}</th>{% endif %}
            <th>{% trans "Department" %}</th>
            <th>{% trans 'Test Title' %}</th>
            <th>{% trans 'Score' %}</th>
            <th>{% trans 'Status' %}</th>
            <th>{% trans 'Time Taken' %}</th>
            <th>{% trans 'Timestamp' %}</th>
            <th>PDF</th>
          </tr>
        </thead>
        <tbody>
          {% for result in results %}
          <tr>
            {% if request.user.is_staff %}
              <td>{{ result.user.username }}</td>
            {% endif %}
            <td>{{ result.department.name }}</td>
            <td>{{ result.quiz.title }}</td>
            <td>{{ result.score }} / {{ result.total_questions }}</td>
            <td>
              {% if request.user.is_staff %}
                <form method="post" action="{% url 'change_status' result.id %}">
                  {% csrf_token %}
                  <select name="status" onchange="this.form.submit()">
                    <option value="Pass" {% if result.status == "Pass" %}selected{% endif %}>Pass</option>
                    <option value="Fail" {% if result.status == "Fail" %}selected{% endif %}>Fail</option>
                  </select>
                </form>
              {% else %}
                {{ result.status }}
              {% endif %}
            </td>
            <td>{{ result.time_taken }}</td>
            <td>{{ result.created_at|date:"Y-m-d H:i" }}</td>
            <td>
              {% if result.pdf_file %}
                <a href="{% url 'download_result_pdf' result.id %}" style="color: black;" target="_blank">{% trans 'Download PDF' %}</a>
              {% else %}
                <span>{% trans 'No PDF available yet.' %}</span>
              {% endif %}
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="color: black;">{% trans 'No test results found.' %}</p>
    {% endif %}
  </div>
{% endblock %}
